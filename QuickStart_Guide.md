# 热传递拓扑优化并行计算快速入门指南

## 🚀 快速开始

### 第一步：检查系统要求
在MATLAB命令窗口中运行以下命令检查系统：

```matlab
% 检查MATLAB版本
version

% 检查Parallel Computing Toolbox
license('test', 'Distrib_Computing_Toolbox')

% 检查可用内存
memory()
```

### 第二步：运行性能基准测试
首先运行基准测试了解您系统的性能：

```matlab
benchmark_parallel
```

这将：
- 测试不同网格尺寸的性能
- 比较串行和并行计算时间
- 显示加速比和并行效率
- 生成性能图表

### 第三步：运行热传递拓扑优化
运行主要的并行优化代码：

```matlab
topFlow_mpi
```

## 📊 预期结果

### 典型性能提升
基于4核CPU的预期结果：

| 网格尺寸 | 串行时间 | 并行时间 | 加速比 | 效率 |
|----------|----------|----------|--------|------|
| 30×30    | 12.5秒   | 4.2秒    | 3.0×   | 75%  |
| 60×60    | 48.3秒   | 15.1秒   | 3.2×   | 80%  |
| 90×90    | 108.7秒  | 32.4秒   | 3.4×   | 85%  |

### 并行效率说明
- **>80%**: 优秀的并行性能
- **60-80%**: 良好的并行性能  
- **<60%**: 需要优化

## ⚙️ 关键参数调整

### 网格密度调整
```matlab
% 在 topFlow_mpi.m 中修改
nely = 60;  % 增大提高精度，减小加快速度
```

### 并行工作器数量
```matlab
% 在运行前设置
parpool('local', 4);  % 使用4个工作器
```

### 优化参数
```matlab
% 收敛容差
nltol = 1e-6;  % 牛顿求解器
chlim = 1e-3;  % 设计变化

% 最大迭代次数
maxiter = 100;  % 根据需要调整
```

## 🔧 常见问题解决

### 问题1：并行池无法启动
**症状**: 提示 "Parallel Computing Toolbox 不可用"

**解决方案**:
```matlab
% 检查许可证
license('test', 'Distrib_Computing_Toolbox')

% 如果返回0，联系管理员获取许可证
```

### 问题2：内存不足
**症状**: 运行中出现内存错误

**解决方案**:
1. 减小网格尺寸：`nely = 30` (替代60)
2. 减少工作器数量：`parpool('local', 2)`
3. 关闭其他程序释放内存

### 问题3：性能提升不明显
**症状**: 加速比低于预期

**解决方案**:
1. 检查CPU核心数：`feature('numcores')`
2. 增大问题规模以提高并行效率
3. 检查是否有其他程序占用CPU

### 问题4：函数文件缺失
**症状**: 提示找不到 RES.m, JAC.m 等文件

**解决方案**:
```matlab
% 检查文件是否存在
which RES
which JAC
which PHI

% 如果返回空，确保文件在当前路径或添加到路径
addpath('路径/到/有限元函数文件夹')
```

## 📈 性能优化技巧

### 1. 硬件优化
- **CPU**: 使用多核处理器
- **内存**: 确保足够RAM (推荐16GB+)
- **存储**: 使用SSD提高I/O性能

### 2. 软件优化
```matlab
% 预分配内存
sR = zeros(16, neltot);
sJ = zeros(256, neltot);

% 避免动态数组增长
results = struct('data', cell(1, max_iterations));
```

### 3. 算法优化
- 使用合适的收敛容差
- 选择适当的网格密度
- 调整自适应参数

## 🎯 最佳实践

### 1. 开始小规模测试
```matlab
% 先用小网格测试
nely = 30;
topFlow_mpi
```

### 2. 逐步增加规模
```matlab
% 确认小规模工作后，增加网格密度
nely = 60;  % 然后 90, 120...
```

### 3. 监控系统资源
```matlab
% 定期检查内存使用
memory()

% 检查并行池状态
gcp()
```

### 4. 保存中间结果
```matlab
% 在长时间计算中保存中间结果
save('checkpoint.mat', 'xPhys', 'S', 'loop');
```

## 📋 检查清单

在运行并行代码前，确保：

- [ ] ✅ MATLAB R2020a或更高版本
- [ ] ✅ Parallel Computing Toolbox可用
- [ ] ✅ 所有必需的.m文件在路径中
- [ ] ✅ 足够的系统内存 (>8GB)
- [ ] ✅ 多核CPU可用
- [ ] ✅ 已运行基准测试了解性能

## 🆘 获取帮助

如果遇到问题：

1. **查看文档**: 阅读 `README_MPI_Parallel.md`
2. **运行基准测试**: `benchmark_parallel` 诊断性能
3. **检查系统**: 确认硬件和软件要求
4. **简化问题**: 从小网格开始测试

## 📞 联系支持

如需进一步帮助，请联系：
- 原始代码作者: joal@sdu.dk  
- 并行化版本: [GitHub Issues](https://github.com/luckywenfenghe)

---

**开始您的并行拓扑优化之旅！** 🚀 